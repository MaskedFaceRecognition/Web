## 목표

1. Windows에 Apache를 통해 nginx 연동해서 Flask 배포 
2. 1번 작업이 잘 되지 않으면 Linux 환경에서 uWSGI/Gunicore/Apache를 통해 nginx 연동해서 배포

<hr>

#### Windows - Apache, modwsgi 작업

### Apache 설치 ( 참고: https://kiwinote.tistory.com/75 ) 
#### 1. Apache 설치
#### 2. 압축 풀고 C(로컬디스크)로 이동
#### 3. 
  - Server Root를 "C:\Apache24"로 변경
  - 포트 : 80
  - documentRoot 설정

#### 4. cmd <- 관리자 모드 실행
  - cd C:\Apache24\bin
  - httpd.exe -k install

#### 5. Apache24/bin에서 실행파일 동작시키면 완료

<hr>

### mod-wsgi ( 참고: https://opentutorials.org/course/3647/25080 )

#### 1. 환경 변수 추가(C:\Program Files\Python37\Lib\;C:\Program Files\Python37\DLLs\)
#### 2. Visual C++ 빌드 도구 설치
- https://visualstudio.microsoft.com/ko/thank-you-downloading-visual-studio/?sku=BuildTools&rel=16 
#### 3. pip install mod-wsgi
- 설치 완료
#### 4. mod_wsgi-express module-config 이용해서 conf 정보 획득, 
- httpd.conf에 해당 정보 추가(맨 밑) 
```
LoadFile "c:/users/82104/anaconda3/envs/graduation-project/python39.dll"
LoadModule wsgi_module "c:/users/82104/anaconda3/envs/graduation-project/lib/site-packages/mod_wsgi/server/mod_wsgi.cp39-win_amd64.pyd"
WSGIPythonHome "c:/users/82104/anaconda3/envs/graduation-project"
```
#### 5. Virtual Host 설정.
- <Apache24-Home>\conf\extra\httpd-vhost.conf file
```
<VirtualHost *:5000>
    ServerAdmin copes.km@gmail.com
    ServerName localhost:5000
    WSGIScriptAlias / "C:/Users/82104/anaconda3/envs/graduation-project/app.wsgi"
    DocumentRoot "C:/Users/82104/anaconda3/envs/graduation-project"
    <Directory "C:/Users/82104/anaconda3/envs/graduation-project">
	Order allow,deny
	Allow from all
	Require all granted
    </Directory>
    ErrorLog "C:/Users/82104/anaconda3/envs/graduation-project/logs/error.log"
    CustomLog "C:/Users/82104/anaconda3/envs/graduation-project/logs/access.log" common
</VirtualHost>
```
  - ServerName 
    - purchased or localhost. 일단은 localhost로 이용
  - WSGIScriptAlias
  - Direct privilege
```
# add Listen Port
Listen 5000
```
  - port 5000으로 설정

#### 6. VirtualHost 추가.
- httpd.conf의 Include 주석 지우고 아래와 같이 입력
`Include conf/extra/httpd-vhosts.conf`

#### 7. apache 동작.
- 에러 검사하려면 다시 시작하면 된다.
`httpd.exe -k restart`
`httpd.exe -k start`

##### 오류 로그 1
```
AH00526: Syntax error on line 214 of /home1/irteam/apps/apache-2.4.39/conf/httpd.conf:
Invalid command 'Order', perhaps misspelled or defined by a module not included in the server configuration
```

##### 해결 방법
> LoadModule access_compat_module modules/mod_access_compat.so <- 추가.

##### 오류 로그 2
- log 폴더가 graduation-project에 없다는 문제

##### 해결 방법
> log 폴더 생성

<hr>

- services.msc -> Apache2.4로 동작 상태 확인 가능









